<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Myron Marston &raquo; Deprecating Constants (and Classes) in Ruby</title>
    <link href="/n/stylesheets/screen.css?b50fa16c695f6c6a869efae6a4772316" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/atom+xml" href="/n/atom.xml" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <meta name="readability-verification" content="MyxhCxTZEe74mzRD75kSVt6rHHukjuVhNeN6U2Wh"/>
  </head>
  <body>
    <div id='menu'>
  <div class="dev-blog active">
    <a href='/n/dev-blog'>Dev Blog</a>
  </div>
  <div class="china">
    <a href='/n/china'>China</a>
  </div>
  <div class="music">
    <a href='/n/music'>Music</a>
  </div>
  <div class="open-source">
    <a href='/n/open-source'>Open Source</a>
  </div>
</div>

    <div id='contents' class='medium-wide dev-blog'>
      <div id="post" class='section'>
  <h1>Deprecating Constants (and Classes) in Ruby</h1>
  <p class="post-date">âžœ 21 Sep 2011</p>

  <div class="content">
    <p>Ruby has great tools for deprecating obselete code. One of my favorite techniques is one I rarely see: using <code>const_missing</code> to deprecate constants, and, by extension, classes and modules.</p>

<p>Consider this code:</p>
<div class='bogus-wrapper'><notextile><div class='code-wrap'><figure class='code'><figcaption><span>my_gem/config.rb </span></figcaption>
 <div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class='k'>module</span> <span class='nn'>MyGem</span>
</span><span class='line'>  <span class='k'>class</span> <span class='nc'>Config</span>
</span><span class='line'>  <span class='k'>end</span>
</span><span class='line'><span class='k'>end</span>
</span></code></pre></td></tr></table></div></figure></div></notextile></div>
<p>At a later time, you decide you would rather name this class <code>MyGem::Configuration</code>. It&#8217;s easy enough to change the name, but you may break backwards compatiblity with people who have references to <code>MyGem::Config</code> in their code.</p>

<p><code>const_missing</code> really comes in handy here:</p>
<div class='bogus-wrapper'><notextile><div class='code-wrap'><figure class='code'><figcaption><span>my_gem/configuration.rb </span></figcaption>
 <div class='highlight'><table><tr><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class='k'>module</span> <span class='nn'>MyGem</span>
</span><span class='line'>  <span class='k'>class</span> <span class='nc'>Configuration</span>
</span><span class='line'>  <span class='k'>end</span>
</span><span class='line'>
</span><span class='line'>  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>const_missing</span><span class='p'>(</span><span class='n'>const_name</span><span class='p'>)</span>
</span><span class='line'>    <span class='k'>super</span> <span class='k'>unless</span> <span class='n'>const_name</span> <span class='o'>==</span> <span class='ss'>:Config</span>
</span><span class='line'>    <span class='nb'>warn</span> <span class='s2'>&quot;`MyGem::Config` has been deprecated. Use `MyGem::Configuration` instead.&quot;</span>
</span><span class='line'>    <span class='no'>Configuration</span>
</span><span class='line'>  <span class='k'>end</span>
</span><span class='line'><span class='k'>end</span>
</span></code></pre></td></tr></table></div></figure></div></notextile></div>
<p>This allows existing code that references <code>MyGem::Config</code> to continue to work, and warns the user about their use of the deprecated constant.</p>
  </div>
</div>

<div id="disqus_thread" class='section'></div>
<script type="text/javascript">
    var disqus_shortname  = 'myronmarston-personal-site';
    var disqus_identifier = '/n/dev-blog/2011/09/deprecating-constants-and-classes-in-ruby';
    var disqus_title      = 'Deprecating Constants (and Classes) in Ruby';
    var disqus_url        = 'http://myronmars.to/n/dev-blog/2011/09/deprecating-constants-and-classes-in-ruby';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<div class='section'>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


    </div>
    <div id='about'>
  <div class='links'>
    <h2>Follow Me</h2>
    <ul>
      <li><a href="http://twitter.com/myronmarston">Twitter</a></li>
      <li><a href="https://github.com/myronmarston">Github</a></li>
      <li><a href="/n/atom.xml">Atom Feed</a></li>
      <li><a href="/n/resume">Resume</a></li>
    </ul>
  </div>
  <div class='bio'>
    <h2>About Me</h2>
    <p>
      <a href="http://bluebirdsandthings.wordpress.com/">Husband and father</a>,
      musician, software engineer at <a href="http://www.seomoz.org/">SEOmoz</a>,
      open source developer specializing in Ruby and Rails, world traveler and Christian.
    </p>
  </div>
</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3938147-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type="text/javascript" src="/n/javascript/audio.js"></script>

  </body>
</html>

